---
/**
 * ResearchCard component - Displays a single research paper
 * 
 * Props:
 * - paper: ResearchPaper object
 * - thumbnailImage: Optional optimized image from glob import
 */
import type { ResearchPaper } from '../data/research';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

export interface Props {
  paper: ResearchPaper;
  thumbnailImage?: ImageMetadata;
}

const { paper, thumbnailImage } = Astro.props;

// Format authors with bolding for team members
const formatAuthors = (authors: { name: string; team?: boolean }[]) => {
  return authors.map(a => a.team ? `<strong>${a.name}</strong>` : a.name).join(', ');
};
---

<a 
  href={paper.url} 
  target="_blank" 
  rel="noopener noreferrer"
  class="research-card-new block rounded-2xl overflow-hidden transition-all duration-300 hover:scale-[1.02] hover:shadow-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700"
>
  {/* Thumbnail */}
  <div class="aspect-[4/3] bg-slate-100 dark:bg-slate-700 overflow-hidden">
    {thumbnailImage ? (
      <Image 
        src={thumbnailImage}
        alt={paper.title}
        widths={[288, 400, 576]}
        sizes="(min-width: 640px) 288px, 85vw"
        class="w-full h-full object-cover object-top"
        loading="lazy"
      />
    ) : (
      <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-800">
        <i class="fas fa-file-pdf text-5xl text-slate-300 dark:text-slate-600" aria-hidden="true"></i>
      </div>
    )}
  </div>
  
  {/* Content */}
  <div class="p-4">
    {/* Title */}
    <h4 class="font-bold text-sm leading-tight mb-2 text-slate-900 dark:text-white line-clamp-2 group-hover:text-bright-purple">
      {paper.title}
    </h4>
    
    {/* Authors (if present) */}
    {paper.authors && paper.authors.length > 0 && (
      <p 
        class="text-xs text-slate-600 dark:text-slate-300 mb-2 line-clamp-1"
        set:html={formatAuthors(paper.authors)}
      />
    )}
    
    {/* Venue (as grey tag) */}
    <div class="mb-3">
      <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-slate-200 text-slate-700 dark:bg-slate-600 dark:text-slate-200">
        {paper.venue}
      </span>
    </div>
    
    {/* Tags */}
    <div class="flex flex-wrap gap-1.5">
      {paper.tags.map(tag => (
        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-bright-purple/10 text-bright-purple dark:bg-bright-purple/20">
          {tag}
        </span>
      ))}
    </div>
  </div>
</a>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
